"""
ìƒí’ˆ ìë™ íƒœê¹… ì‹œìŠ¤í…œ
í¬ë¡¤ë§ëœ ìƒí’ˆ ë°ì´í„°ì— ìë™ìœ¼ë¡œ íƒœê·¸ë¥¼ ë¶€ì—¬
"""

import json
import re
from typing import Dict, List, Set
from product_taxonomy import (
    PRODUCT_CATEGORIES,
    PRODUCT_ATTRIBUTE_TAGS,
    MATCHING_RULES
)


class ProductTagger:
    """ìƒí’ˆ ìë™ íƒœê¹… í´ë˜ìŠ¤"""

    def __init__(self):
        self.category_keywords = self._build_category_keywords()
        self.ingredient_keywords = self._build_ingredient_keywords()
        self.concern_keywords = self._build_concern_keywords()

    def _build_category_keywords(self) -> Dict[str, List[str]]:
        """ì¹´í…Œê³ ë¦¬ë³„ í‚¤ì›Œë“œ ë§µí•‘"""
        return {
            # ìŠ¤í‚¨ì¼€ì–´ - í´ë Œì§•
            "ìŠ¤í‚¨ì¼€ì–´-í´ë Œì§•-ë©”ì´í¬ì—… ë¦¬ë¬´ë²„": ["ë©”ì´í¬ì—…ë¦¬ë¬´ë²„", "ë©”ì´í¬ì—… ë¦¬ë¬´ë²„", "ë¦¬ë¬´ë²„", "í¬ì¸íŠ¸ë¦¬ë¬´ë²„"],
            "ìŠ¤í‚¨ì¼€ì–´-í´ë Œì§•-í´ë Œì§• í¼": ["í´ë Œì§•í¼", "í´ë Œì§• í¼", "í¼í´ë Œì €", "ì›Œì‹œ", "í¼ì›Œì‹œ", "ì•„ë¯¸ë…¸ í¼", "ì•„ë¯¸ë…¸í¼", "ì˜¤ì¼ í¼ í´ë Œì €"],
            "ìŠ¤í‚¨ì¼€ì–´-í´ë Œì§•-í•„ë§&ìŠ¤í¬ëŸ½": ["í•„ë§", "ìŠ¤í¬ëŸ½", "í•„", "ê°ì§ˆì œê±°"],
            "ìŠ¤í‚¨ì¼€ì–´-í´ë Œì§•-í´ë Œì§• í‹°ìŠˆ": ["í´ë Œì§•í‹°ìŠˆ", "í´ë Œì§• í‹°ìŠˆ", "í´ë Œì§•ì‹œíŠ¸", "í‹°ìŠˆ"],
            "ìŠ¤í‚¨ì¼€ì–´-í´ë Œì§•-í´ë Œì§• ì˜¤ì¼": ["í´ë Œì§•ì˜¤ì¼", "í´ë Œì§• ì˜¤ì¼", "ì˜¤ì¼í´ë Œì €", "í´ë Œì§•ë°¤", "í´ë Œì§• ë°¤"],
            "ìŠ¤í‚¨ì¼€ì–´-í´ë Œì§•-í´ë Œì§• ì›Œí„°": ["í´ë Œì§•ì›Œí„°", "í´ë Œì§• ì›Œí„°", "ì›Œí„°í´ë Œì €", "ë¯¸ì…€ë¼ì›Œí„°"],

            # ìŠ¤í‚¨ì¼€ì–´ - ëª¨ì´ìŠ¤ì²˜ë¼ì´ì§•
            "ìŠ¤í‚¨ì¼€ì–´-ëª¨ì´ìŠ¤ì²˜ë¼ì´ì§•-ìŠ¤í‚¨&í† ë„ˆ": ["í† ë„ˆ", "ìŠ¤í‚¨", "ì—ì„¼ìŠ¤ì›Œí„°", "í™”ì¥ìˆ˜", "ììŒìˆ˜"],
            "ìŠ¤í‚¨ì¼€ì–´-ëª¨ì´ìŠ¤ì²˜ë¼ì´ì§•-ë¡œì…˜&ì—ë©€ì ¼": ["ë¡œì…˜", "ì—ë©€ì „", "ì—ë©€ì ¼", "ë°€í¬", "ììŒìœ ì•¡"],
            "ìŠ¤í‚¨ì¼€ì–´-ëª¨ì´ìŠ¤ì²˜ë¼ì´ì§•-ì—ì„¼ìŠ¤&ì„¸ëŸ¼": ["ì—ì„¼ìŠ¤", "ì„¸ëŸ¼", "ì„¸ë²”"],
            "ìŠ¤í‚¨ì¼€ì–´-ëª¨ì´ìŠ¤ì²˜ë¼ì´ì§•-í¬ë¦¼": ["í¬ë¦¼", "ì ¤í¬ë¦¼", "ìˆ˜ë¶„í¬ë¦¼"],
            "ìŠ¤í‚¨ì¼€ì–´-ëª¨ì´ìŠ¤ì²˜ë¼ì´ì§•-ì•„ì´&ë„¥": ["ì•„ì´í¬ë¦¼", "ì•„ì´ í¬ë¦¼", "ì•„ì´ì¼€ì–´", "ì•„ì´ì¡´", "ë„¥í¬ë¦¼"],
            "ìŠ¤í‚¨ì¼€ì–´-ëª¨ì´ìŠ¤ì²˜ë¼ì´ì§•-ë¯¸ìŠ¤íŠ¸": ["ë¯¸ìŠ¤íŠ¸"],

            # ìŠ¤í‚¨ì¼€ì–´ - ìŠ¤í˜ì…œ ì¼€ì–´
            "ìŠ¤í‚¨ì¼€ì–´-ìŠ¤í˜ì…œ ì¼€ì–´-ë§ˆìŠ¤í¬&íŒ©": ["ë§ˆìŠ¤í¬", "ìŠ¬ë¦¬í•‘íŒ©", "ì‹œíŠ¸ë§ˆìŠ¤í¬", "ì›Œì‹œì˜¤í”„íŒ©", "í¼ë°íŒ©", "ë©œë¼ë‹Œ íŒ©"],
            "ìŠ¤í‚¨ì¼€ì–´-ìŠ¤í˜ì…œ ì¼€ì–´-í˜ì´ìŠ¤ ì˜¤ì¼": ["í˜ì´ìŠ¤ì˜¤ì¼", "í˜ì´ìŠ¤ ì˜¤ì¼", "í˜ì´ì…œì˜¤ì¼", "í˜ì´ì…œ ì˜¤ì¼", "ì–¼êµ´ì˜¤ì¼"],
            "ìŠ¤í‚¨ì¼€ì–´-ìŠ¤í˜ì…œ ì¼€ì–´-ì•°í”Œ": ["ì•°í”Œ", "ê³ ë†ì¶•ì•°í”Œ"],
            "ìŠ¤í‚¨ì¼€ì–´-ìŠ¤í˜ì…œ ì¼€ì–´-ì½”íŒ©": ["ì½”íŒ©", "ë¸”ë™í—¤ë“œ", "ì½”ì¼€ì–´"],

            # ìŠ¤í‚¨ì¼€ì–´ - ì„ ì¼€ì–´
            "ìŠ¤í‚¨ì¼€ì–´-ì„ ì¼€ì–´-ì„ ë¸”ëŸ­": ["ì„ ë¸”ëŸ­", "ì„ í¬ë¦¼", "ìì™¸ì„ ì°¨ë‹¨", "ì¬í¬ë¦¼", "ì„ ë¡œì…˜"],
            "ìŠ¤í‚¨ì¼€ì–´-ì„ ì¼€ì–´-ì„ ìŠ¤í”„ë ˆì´": ["ì„ ìŠ¤í”„ë ˆì´", "ì¬ìŠ¤í”„ë ˆì´"],
            "ìŠ¤í‚¨ì¼€ì–´-ì„ ì¼€ì–´-ì„ ìŠ¤í‹±": ["ì„ ìŠ¤í‹±", "ì¬ìŠ¤í‹±"],

            # ìŠ¤í‚¨ì¼€ì–´ - ì„¸íŠ¸
            "ìŠ¤í‚¨ì¼€ì–´-ì„¸íŠ¸": ["ì„¸íŠ¸", "í‚¤íŠ¸"],

            # ìŠ¤í‚¨ì¼€ì–´ - ë¦¬í•„
            "ìŠ¤í‚¨ì¼€ì–´-ë¦¬í•„": ["ë¦¬í•„"],

            # ë©”ì´í¬ì—… - í˜ì´ìŠ¤
            "ë©”ì´í¬ì—…-í˜ì´ìŠ¤-ì»¨ì‹¤ëŸ¬": ["ì»¨ì‹¤ëŸ¬"],
            "ë©”ì´í¬ì—…-í˜ì´ìŠ¤-íŒŒìš´ë°ì´ì…˜": ["íŒŒìš´ë°ì´ì…˜"],
            "ë©”ì´í¬ì—…-í˜ì´ìŠ¤-íŒŒìš°ë”": ["íŒŒìš°ë”íŒ©íŠ¸", "í”¼ë‹ˆì‹œ íŒŒìš°ë”", "í”¼ë‹ˆì‹œíŒŒìš°ë”", "ë¸”ëŸ¬ë§ íŒŒìš°ë”", "ë¸”ëŸ¬ë§íŒŒìš°ë”", "ì„¸ë²” íŒŒìš°ë”", "í—¤ì–´ ë©”ì´í¬ì—… íŒŒìš°ë”"],
            "ë©”ì´í¬ì—…-í˜ì´ìŠ¤-í”„ë¼ì´ë¨¸&ë² ì´ìŠ¤": ["í”„ë¼ì´ë¨¸", "ë©”ì´í¬ì—…ë² ì´ìŠ¤", "ë©”ì´í¬ í‚µ ë² ì´ìŠ¤", "ë©”ì´í¬ë² ì´ìŠ¤"],
            "ë©”ì´í¬ì—…-í˜ì´ìŠ¤-BB&CCí¬ë¦¼": ["bbí¬ë¦¼", "bb í¬ë¦¼", "ccí¬ë¦¼", "cc í¬ë¦¼", "ë¹„ë¹„í¬ë¦¼", "ì”¨ì”¨í¬ë¦¼"],
            "ë©”ì´í¬ì—…-í˜ì´ìŠ¤-ì¿ ì…˜": ["ì¿ ì…˜"],

            # ë©”ì´í¬ì—… - ë¦½
            "ë©”ì´í¬ì—…-ë¦½-ë¦½ìŠ¤í‹±": ["ë¦½ìŠ¤í‹±", "ë¦½ì»¬ëŸ¬"],
            "ë©”ì´í¬ì—…-ë¦½-ë¦½ê¸€ë¡œìŠ¤": ["ë¦½ê¸€ë¡œìŠ¤", "ë¦½ ê¸€ë¡œìŠ¤", "ê¸€ë¡œìŠ¤"],
            "ë©”ì´í¬ì—…-ë¦½-ë¦½ì¼€ì–´&ë¦½ë°¤": ["ë¦½ë°¤", "ë¦½ ë°¤", "ë¦½ì¼€ì–´", "ë¦½ ì¼€ì–´", "ë¦½íŠ¸ë¦¬íŠ¸ë¨¼íŠ¸", "ê¸€ë¡œì´ ë°¤", "ê¸€ë¡œì´ë°¤"],
            "ë©”ì´í¬ì—…-ë¦½-ë¦½í‹´íŠ¸": ["ë¦½í‹´íŠ¸", "ë¦½ í‹´íŠ¸", "í‹´íŠ¸"],

            # ë©”ì´í¬ì—… - ì•„ì´
            "ë©”ì´í¬ì—…-ì•„ì´-ë§ˆìŠ¤ì¹´ë¼": ["ë§ˆìŠ¤ì¹´ë¼"],
            "ë©”ì´í¬ì—…-ì•„ì´-ì•„ì´í”„ë¼ì´ë¨¸": ["ì•„ì´í”„ë¼ì´ë¨¸", "ì•„ì´ í”„ë¼ì´ë¨¸", "ì•„ì´ë² ì´ìŠ¤", "ì•„ì´ ë©”ì´í¬ë² ì´ìŠ¤"],
            "ë©”ì´í¬ì—…-ì•„ì´-ì•„ì´ë¸Œë¡œìš°": ["ì•„ì´ë¸Œë¡œìš°", "ì•„ì´ ë¸Œë¡œìš°", "ë¸Œë¡œìš°", "ëˆˆì¹", "ì•„ì´ë¸Œë¼ìš°"],
            "ë©”ì´í¬ì—…-ì•„ì´-ì•„ì´ë˜ì‰¬": ["ì•„ì´ë˜ì‰¬", "ì†ëˆˆì¹"],
            "ë©”ì´í¬ì—…-ì•„ì´-ì•„ì´ë¼ì´ë„ˆ": ["ì•„ì´ë¼ì´ë„ˆ", "ì•„ì´ ë¼ì´ë„ˆ", "ë¼ì´ë„ˆ", "ì•„ì´ë¼ì¸"],
            "ë©”ì´í¬ì—…-ì•„ì´-ì•„ì´ì„€ë„ìš°": ["ì•„ì´ì„€ë„ìš°", "ì•„ì´ ì„€ë„ìš°", "ì„€ë„ìš°", "ì•„ì´ì„€ë„"],

            # ë©”ì´í¬ì—… - ì¹˜í¬
            "ë©”ì´í¬ì—…-ì¹˜í¬-ë¸”ëŸ¬ì…”": ["ë¸”ëŸ¬ì…”", "ì¹˜í¬"],
            "ë©”ì´í¬ì—…-ì¹˜í¬-ë¸Œë¡ ì ¸": ["ë¸Œë¡ ì ¸", "ë¸Œë¡ ì €"],
            "ë©”ì´í¬ì—…-ì¹˜í¬-í•˜ì´ë¼ì´í„°": ["í•˜ì´ë¼ì´íŠ¸", "í•˜ì´ë¼ì´í„°"],
            "ë©”ì´í¬ì—…-ì¹˜í¬-ì‰ì´ë”©": ["ì‰ì´ë”©", "ë§¤íŠ¸ ì‰ì´ë”©"],

            # ë©”ì´í¬ì—… - í‚¤íŠ¸&íŒ”ë ˆíŠ¸
            "ë©”ì´í¬ì—…-í‚¤íŠ¸&íŒ”ë ˆíŠ¸": ["íŒ”ë ˆíŠ¸"],

            # ë©”ì´í¬ì—… - ë„¤ì¼
            "ë©”ì´í¬ì—…-ë„¤ì¼-ë„¤ì¼ ì»¬ëŸ¬": ["ë„¤ì¼ì»¬ëŸ¬", "ë„¤ì¼ ì»¬ëŸ¬", "ë§¤ë‹ˆíì–´", "ë„¤ì¼í´ë¦¬ì‰¬"],
            "ë©”ì´í¬ì—…-ë„¤ì¼-íƒ‘&ë² ì´ìŠ¤ì½”íŠ¸": ["íƒ‘ì½”íŠ¸", "ë² ì´ìŠ¤ì½”íŠ¸"],
            "ë©”ì´í¬ì—…-ë„¤ì¼-íí‹°í´&ì˜ì–‘": ["íí‹°í´", "ë„¤ì¼ì˜ì–‘"],
            "ë©”ì´í¬ì—…-ë„¤ì¼-ë„¤ì¼ ë¦¬ë¬´ë²„": ["ë„¤ì¼ë¦¬ë¬´ë²„", "ë„¤ì¼ ë¦¬ë¬´ë²„"],
            "ë©”ì´í¬ì—…-ë„¤ì¼-ë„¤ì¼ì•„íŠ¸&ìŠ¤í‹°ì»¤": ["ë„¤ì¼ì•„íŠ¸", "ë„¤ì¼ ì•„íŠ¸", "ë„¤ì¼ìŠ¤í‹°ì»¤"],
            "ë©”ì´í¬ì—…-ë„¤ì¼-ë„¤ì¼ ë„êµ¬&í‚¤íŠ¸": ["ë„¤ì¼ë„êµ¬", "ë„¤ì¼ ë„êµ¬", "ë„¤ì¼í‚¤íŠ¸"],

            # ë©”ì´í¬ì—… - ë¦¬í•„
            "ë©”ì´í¬ì—…-ë¦¬í•„": ["ë¦¬í•„"],

            # í–¥ìˆ˜
            "í–¥ìˆ˜-í–¥ìˆ˜-ì—¬ì„±í–¥ìˆ˜": ["ì—¬ì„±í–¥ìˆ˜", "ìš°ë¨¼í–¥ìˆ˜"],
            "í–¥ìˆ˜-í–¥ìˆ˜-ë‚¨ì„±í–¥ìˆ˜": ["ë‚¨ì„±í–¥ìˆ˜", "ë§¨ì¦ˆí–¥ìˆ˜"],
            "í–¥ìˆ˜-í–¥ìˆ˜-ìƒ¤ì›Œì½”ë¡±": ["ìƒ¤ì›Œì½”ë¡±", "ì½”ë¡±"],
            "í–¥ìˆ˜-í–¥ìˆ˜-ë‚¨ë…€ê³µìš©": ["ë‚¨ë…€ê³µìš©", "ìœ ë‹ˆì„¹ìŠ¤í–¥ìˆ˜"],
            "í–¥ìˆ˜-í–¥ìˆ˜-í–¥ìˆ˜ì„¸íŠ¸": ["í–¥ìˆ˜ì„¸íŠ¸"],
            "í–¥ìˆ˜-í–¥ìˆ˜": ["í¼í“¸", "í–¥ìˆ˜", "ì†”ë¦¬ë“œí¼í“¸", "eau de"],

            # ìƒí™œìš©í’ˆ - ë°”ë””
            "ìƒí™œìš©í’ˆ-ë°”ë””-ë°”ë””ì›Œì‹œ": ["ë°”ë””ì›Œì‹œ", "ìƒ¤ì›Œì ¤", "ë³´ë””ì›Œì‹œ"],
            "ìƒí™œìš©í’ˆ-ë°”ë””-ë°”ë””ìŠ¤í¬ëŸ½": ["ë°”ë””ìŠ¤í¬ëŸ½", "ë³´ë””ìŠ¤í¬ëŸ½"],
            "ìƒí™œìš©í’ˆ-ë°”ë””-ë°”ë””ëª¨ì´ìŠ¤ì²˜ë¼ì´ì €": ["ë°”ë””ë¡œì…˜", "ë°”ë”” ë¡œì…˜", "ë°”ë””í¬ë¦¼", "ë°”ë”” í¬ë¦¼", "ë³´ë””ë¡œì…˜"],
            "ìƒí™œìš©í’ˆ-ë°”ë””-ë°”ë””ì˜¤ì¼&ë¯¸ìŠ¤íŠ¸": ["ë°”ë””ì˜¤ì¼", "ë°”ë”” ì˜¤ì¼", "ë°”ë””ë¯¸ìŠ¤íŠ¸"],
            "ìƒí™œìš©í’ˆ-ë°”ë””-í•¸ë“œ&í’‹ì¼€ì–´": ["í•¸ë“œí¬ë¦¼", "í•¸ë“œ í¬ë¦¼", "í’‹í¬ë¦¼", "í•¸ë“œì¼€ì–´", "í’‹ì¼€ì–´"],
            "ìƒí™œìš©í’ˆ-ë°”ë””-ë°ì˜¤ë“œë€íŠ¸": ["ë°ì˜¤ë“œë€íŠ¸", "ë°œí–¥ì œ"],
            "ìƒí™œìš©í’ˆ-ë°”ë””-ì¬ì¼€ì–´": ["ë°”ë””ì„ í¬ë¦¼", "ë°”ë”” ì„ í¬ë¦¼"],
            "ìƒí™œìš©í’ˆ-ë°”ë””-ë¹„ëˆ„": ["ë¹„ëˆ„", "ì†", "soap"],

            # ìƒí™œìš©í’ˆ - êµ¬ê°•
            "ìƒí™œìš©í’ˆ-êµ¬ê°•-ì¹˜ì•½": ["ì¹˜ì•½"],
            "ìƒí™œìš©í’ˆ-êµ¬ê°•-ì¹«ì†”": ["ì¹«ì†”"],
            "ìƒí™œìš©í’ˆ-êµ¬ê°•-í˜€í´ë¦¬ë„ˆ": ["í˜€í´ë¦¬ë„ˆ", "ì„¤íƒœì œê±°"],

            # ìƒí™œìš©í’ˆ - í—¤ì–´
            "ìƒí™œìš©í’ˆ-í—¤ì–´-ìƒ´í‘¸": ["ìƒ´í‘¸", "ë§¤ì§ ìŠ¤íŠ¸ë ˆì´íŠ¸ ì„¸ëŸ¼ ìƒ´í‘¸"],
            "ìƒí™œìš©í’ˆ-í—¤ì–´-ë¦°ìŠ¤&ì»¨ë””ì…”ë„ˆ": ["ë¦°ìŠ¤", "ì»¨ë””ì…”ë„ˆ"],
            "ìƒí™œìš©í’ˆ-í—¤ì–´-íŠ¸ë¦¬íŠ¸ë¨¼íŠ¸&íŒ©": ["í—¤ì–´íŠ¸ë¦¬íŠ¸ë¨¼íŠ¸", "í—¤ì–´ íŠ¸ë¦¬íŠ¸ë¨¼íŠ¸", "íŠ¸ë¦¬íŠ¸ë¨¼íŠ¸", "í—¤ì–´íŒ©"],
            "ìƒí™œìš©í’ˆ-í—¤ì–´-ì—ì„¼ìŠ¤&ì„¸ëŸ¼&ì˜¤ì¼": ["í—¤ì–´ì—ì„¼ìŠ¤", "í—¤ì–´ ì—ì„¼ìŠ¤", "í—¤ì–´ì˜¤ì¼", "í—¤ì–´ ì˜¤ì¼", "í—¤ì–´ì„¸ëŸ¼", "í—¤ì–´ ì„¸ëŸ¼", "ë¦¬í˜ì–´ ì˜¤ì¼", "ë³¸ë”© ì˜¤ì¼", "ì‹œì¹´ ë³¸ë”© ì˜¤ì¼", "cmc ì˜¤ì¼", "ì‹¤í‚¤ ì˜¤ì¼", "ì¼€ì–´ ì˜¤ì¼", "ì¸ë¦¬ì¹˜ ë³¸ë”©"],
            "ìƒí™œìš©í’ˆ-í—¤ì–´-ìŠ¤íƒ€ì¼ë§": ["í—¤ì–´ì™ìŠ¤", "í—¤ì–´ ì™ìŠ¤", "í—¤ì–´ìŠ¤í”„ë ˆì´", "í—¤ì–´ ìŠ¤í”„ë ˆì´", "í—¤ì–´ì ¤", "í—¤ì–´ë¬´ìŠ¤", "íŒŒì›Œ ìŠ¤ìœ™ ì™ìŠ¤", "ìŠ¤ìœ™ ì™ìŠ¤", "í—¬ë¡œë²„ë¸”", "í—¤ì–´ í˜ì´ìŠ¤íŠ¸", "ë¦¬ë¸Œ ì¸ í¼", "ë³¼ë¥¨ í”½ì„œ"],
            "ìƒí™œìš©í’ˆ-í—¤ì–´-ì»¬ëŸ¬": ["ì—¼ìƒ‰", "í—¤ì–´ì»¬ëŸ¬", "í—¤ì–´ ì»¬ëŸ¬", "ì—¼ìƒ‰ì•½", "í—¬ë¡œë²„ë¸”"],
            "ìƒí™œìš©í’ˆ-í—¤ì–´-ë‘í”¼ì¼€ì–´": ["ìŠ¤ì¹¼í”„ í† ë‹‰", "ìŠ¤ì¼€ì¼ë§ ìŠ¤ì™‘", "ë‘í”¼ì¼€ì–´", "íƒˆëª¨ì™„í™”"],

            # ìƒí™œìš©í’ˆ - ë¦¬í•„
            "ìƒí™œìš©í’ˆ-ë¦¬í•„": ["ë¦¬í•„"],

            # ìƒí™œìš©í’ˆ - ì˜ë£Œìš©í’ˆ
            "ìƒí™œìš©í’ˆ-ì˜ë£Œìš©í’ˆ-íŒŒìŠ¤": ["íŒŒìŠ¤", "í•«íŒ©", "ëƒ‰ì°œì§ˆ", "ì˜¨ì°œì§ˆ", "ì•„ì´ì˜¨íŒ©", "ì˜¨íŒ©", "í—ˆë¦¬ì˜¨íŒ©", "í—ˆë¸Œì˜¨íŒ©"],
            "ìƒí™œìš©í’ˆ-ì˜ë£Œìš©í’ˆ-ê±´ê°•ìš©í’ˆ": ["í”¼íŒ…", "ì••ë°•ë°´ë“œ", "ë³´í˜¸ëŒ€"],
            "ìƒí™œìš©í’ˆ-ì˜ë£Œìš©í’ˆ-ê¸°íƒ€": ["ì˜ë£Œ", "í—¬ìŠ¤ì¼€ì–´ìš©í’ˆ"],

            # ì†Œí’ˆ&ë„êµ¬ - ë¯¸ìš© ì†Œë„êµ¬
            "ì†Œí’ˆ&ë„êµ¬-ë¯¸ìš© ì†Œë„êµ¬-ê¸°ë¦„ì¢…ì´": ["ê¸°ë¦„ì¢…ì´", "ì˜¤ì¼ ì»¨íŠ¸ë¡¤ í˜ì´í¼"],
            "ì†Œí’ˆ&ë„êµ¬-ë¯¸ìš© ì†Œë„êµ¬-ìŠ¤í€ì§€&í¼í”„": ["ìŠ¤í€ì§€", "í¼í”„"],
            "ì†Œí’ˆ&ë„êµ¬-ë¯¸ìš© ì†Œë„êµ¬-í™”ì¥ì†œ": ["í™”ì¥ì†œ", "ì†œ", "ë©´ë´‰", "ì½”íŠ¼"],
            "ì†Œí’ˆ&ë„êµ¬-ë¯¸ìš© ì†Œë„êµ¬-ìš©ê¸°": ["ìš©ê¸°", "ê³µë³‘"],
            "ì†Œí’ˆ&ë„êµ¬-ë¯¸ìš© ì†Œë„êµ¬-ê´„ì‚¬": ["ê´„ì‚¬", "ë°”ë”” ê´„ì‚¬", "ì„¸ë¼ë¯¹ ê´„ì‚¬"],

            # ì†Œí’ˆ&ë„êµ¬ - ë°”ë””&í—¤ì–´ ì†Œí’ˆ
            "ì†Œí’ˆ&ë„êµ¬-ë°”ë””&í—¤ì–´ ì†Œí’ˆ": [],

            # ì†Œí’ˆ&ë„êµ¬ - ìº”ë“¤&ë””í“¨ì €
            "ì†Œí’ˆ&ë„êµ¬-ìº”ë“¤&ë””í“¨ì €": ["ìº”ë“¤", "ë””í“¨ì €", "í–¥ì´ˆ"],

            # ì†Œí’ˆ&ë„êµ¬ - ë¸ŒëŸ¬ì‰¬
            "ì†Œí’ˆ&ë„êµ¬-ë¸ŒëŸ¬ì‰¬-ì–¼êµ´ì „ìš©": ["í˜ì´ìŠ¤ë¸ŒëŸ¬ì‰¬", "í˜ì´ìŠ¤ ë¸ŒëŸ¬ì‰¬"],
            "ì†Œí’ˆ&ë„êµ¬-ë¸ŒëŸ¬ì‰¬-ì¹˜í¬ì „ìš©": ["ì¹˜í¬ë¸ŒëŸ¬ì‰¬", "ì¹˜í¬ ë¸ŒëŸ¬ì‰¬"],
            "ì†Œí’ˆ&ë„êµ¬-ë¸ŒëŸ¬ì‰¬-ëˆˆì „ìš©": ["ì•„ì´ë¸ŒëŸ¬ì‰¬", "ì•„ì´ ë¸ŒëŸ¬ì‰¬"],
            "ì†Œí’ˆ&ë„êµ¬-ë¸ŒëŸ¬ì‰¬-ì…ìˆ ì „ìš©": ["ë¦½ë¸ŒëŸ¬ì‰¬", "ë¦½ ë¸ŒëŸ¬ì‰¬"],
            "ì†Œí’ˆ&ë„êµ¬-ë¸ŒëŸ¬ì‰¬-ë¸ŒëŸ¬ì‰¬ ì„¸íŠ¸": ["ë¸ŒëŸ¬ì‰¬ì„¸íŠ¸", "ë¸ŒëŸ¬ì‰¬ ì„¸íŠ¸"],
            "ì†Œí’ˆ&ë„êµ¬-ë¸ŒëŸ¬ì‰¬": ["ë¸ŒëŸ¬ì‰¬", "ë¸ŒëŸ¬ì‹œ", "ë©”ì´í¬ì—…ë¸ŒëŸ¬ì‰¬"],

            # ì†Œí’ˆ&ë„êµ¬ - ì†ëˆˆì¹
            "ì†Œí’ˆ&ë„êµ¬-ì†ëˆˆì¹": ["ì¸ì¡°ì†ëˆˆì¹", "ê°€ì§œì†ëˆˆì¹"],

            # ë·°í‹°í‘¸ë“œ - ê±´ê°•ì‹í’ˆ
            "ë·°í‹°í‘¸ë“œ-ê±´ê°•ì‹í’ˆ-ìŠ¬ë¦¬ë°": ["ìŠ¬ë¦¬ë°", "ë‹¤ì´ì–´íŠ¸", "ë©”íƒ€ê·¸ë¦°"],
            "ë·°í‹°í‘¸ë“œ-ê±´ê°•ì‹í’ˆ-ì´ë„ˆë·°í‹°": ["ì´ë„ˆë·°í‹°", "ë·°í‹°í‘¸ë“œ", "ê±´ê°•ê¸°ëŠ¥ì‹í’ˆ", "íˆì•Œë£¨ë¡ ì‚°", "ìŠˆí¼ì½œë¼ê²", "ì½œë¼ê²", "ë ˆí‹°ë†€", "ìŠˆí¼ë ˆí‹°ë†€", "ìŠˆí¼ì—ì„¼ì…œ"],
            "ë·°í‹°í‘¸ë“œ-ê±´ê°•ì‹í’ˆ-ì˜ì–‘ë³´ì¶©": ["ì˜ì–‘ì œ", "ë¹„íƒ€ë¯¼", "ì˜ì–‘ë³´ì¶©", "ì˜¤ë©”ê°€ì¼€ì–´", "ì•¡í‹°ë¸Œ ë©€í‹°íŒ©", "íŠ¸ë£¨ì•„ì´", "êµ¿ìŠ¬ë¦½", "ê°€ë°”"],
            "ë·°í‹°í‘¸ë“œ-ê±´ê°•ì‹í’ˆ-í™ì‚¼&ì§„ìƒë² ë¦¬": ["í™ì‚¼", "ì§„ìƒë² ë¦¬", "ì¸ì‚¼", "ëª…ì‘ìˆ˜"],

            # ë·°í‹°í‘¸ë“œ - ì°¨(TEA)/ê°„ì‹
            "ë·°í‹°í‘¸ë“œ-ì°¨/ê°„ì‹-ê¸°í”„íŠ¸ì„¸íŠ¸": ["í‹°ì„¸íŠ¸", "ì°¨ì„¸íŠ¸"],
            "ë·°í‹°í‘¸ë“œ-ì°¨/ê°„ì‹-ë…¹ì°¨": ["ë…¹ì°¨"],
            "ë·°í‹°í‘¸ë“œ-ì°¨/ê°„ì‹-ë¸”ë Œë”©í‹°": ["ë¸”ë Œë”©í‹°"],
            "ë·°í‹°í‘¸ë“œ-ì°¨/ê°„ì‹-í—ˆë¸Œì°¨": ["í—ˆë¸Œì°¨"],
            "ë·°í‹°í‘¸ë“œ-ì°¨/ê°„ì‹-í™ì°¨": ["í™ì°¨"],
            "ë·°í‹°í‘¸ë“œ-ì°¨/ê°„ì‹-ê¸°íƒ€ ì°¨": ["ì°¨", "tea", "í´ë¦°í‹°", "ë©”íƒ€ê·¸ë¦° í´ë¦°í‹°", "íš¨ì†Œ"],

            # ë‚¨ì„±
            "ë‚¨ì„±-í´ë Œì ¸": ["ë‚¨ì„±í´ë Œì§•", "ë‚¨ì„± í´ë Œì§•", "ë§¨ì¦ˆí´ë Œì§•"],
            "ë‚¨ì„±-ìŠ¤í‚¨&ë¡œì…˜": ["ë‚¨ì„±ìŠ¤í‚¨", "ë‚¨ì„± ìŠ¤í‚¨", "ë‚¨ì„±ë¡œì…˜", "ë‚¨ì„± ë¡œì…˜", "ë§¨ì¦ˆìŠ¤í‚¨", "ë§¨ì¦ˆë¡œì…˜"],
            "ë‚¨ì„±-ì—ì„¼ìŠ¤&í¬ë¦¼": ["ë‚¨ì„±ì—ì„¼ìŠ¤", "ë‚¨ì„± ì—ì„¼ìŠ¤", "ë‚¨ì„±í¬ë¦¼", "ë‚¨ì„± í¬ë¦¼"],
            "ë‚¨ì„±-íŒ©&ë§ˆìŠ¤í¬": ["ë‚¨ì„±íŒ©", "ë‚¨ì„± íŒ©", "ë‚¨ì„±ë§ˆìŠ¤í¬"],
            "ë‚¨ì„±-ì¬&BBí¬ë¦¼": ["ë‚¨ì„±ì„ í¬ë¦¼", "ë‚¨ì„± ì„ í¬ë¦¼", "ë‚¨ì„±bb", "ë‚¨ì„± bb"],
            "ë‚¨ì„±-ì‰ì´ë¹™": ["ì‰ì´ë¹™", "ë©´ë„"],
            "ë‚¨ì„±-ë°”ë””ì¼€ì–´": ["ë‚¨ì„±ë°”ë””"],
            "ë‚¨ì„±-í—¤ì–´ì¼€ì–´": ["ë‚¨ì„±í—¤ì–´"],
            "ë‚¨ì„±-ë©”ì´í¬ì—…": ["ë‚¨ì„±ë©”ì´í¬ì—…"],

            # ë² ì´ë¹„
            "ë² ì´ë¹„-ìŠ¤í‚¨/ë°”ë””ì¼€ì–´": ["ë² ì´ë¹„ë¡œì…˜", "ë² ì´ë¹„ ë¡œì…˜", "ìœ ì•„ë¡œì…˜"],
            "ë² ì´ë¹„-ì„ ì¼€ì–´": ["ë² ì´ë¹„ì„ í¬ë¦¼", "ë² ì´ë¹„ ì„ í¬ë¦¼", "ìœ ì•„ì„ í¬ë¦¼"],

            # ë·°í‹°ë””ë°”ì´ìŠ¤
            "ë·°í‹°ë””ë°”ì´ìŠ¤-í˜ì´ì…œì¼€ì–´ ê¸°ê¸°": ["ìŠ¤í‚¨ì¼€ì–´ê¸°ê¸°", "í˜ì´ì…œê¸°ê¸°", "í˜ì´ì…œ ë¶€ìŠ¤íŒ…", "ìŠ¤íŒŒ ìº¡ìŠ"],
            "ë·°í‹°ë””ë°”ì´ìŠ¤-êµ¬ê°•ì¼€ì–´ ê¸°ê¸°": ["ì „ë™ì¹«ì†”", "êµ¬ê°•ì„¸ì²™ê¸°"],
            "ë·°í‹°ë””ë°”ì´ìŠ¤-í—¤ì–´ì¼€ì–´ ê¸°ê¸°": ["ë“œë¼ì´ê¸°", "ê³ ë°ê¸°", "ì•„ì´ë¡±", "í—¤ì–´ë“œë¼ì´ì–´", "ì»¬ë§ì•„ì´ë¡±", "ë´‰ê³ ë°ê¸°", "ë³¼ë¥¨ê³ ë°ê¸°", "ë§¤ì§ê¸°"],
            "ë·°í‹°ë””ë°”ì´ìŠ¤-í—¬ìŠ¤ì¼€ì–´ ê¸°ê¸°": ["ì²´ì¤‘ê³„", "í—¬ìŠ¤ì¼€ì–´", "ì•ˆë§ˆê¸°", "ë§ˆì‚¬ì§€ê¸°", "ìŠ¤í…í¼", "ìŠ¤íƒ­ë°€", "í™ˆíŠ¸ë ˆì´ë‹", "ìš´ë™ê¸°êµ¬", "í”¼íŠ¸ë‹ˆìŠ¤", "íŒŒë¼í•€", "ì™ìŠ¤ìš©í•´ê¸°", "ë°”ë””ë¡¤ëŸ¬", "ì†Œë…¸ í…Œë¼í”¼"],
            "ë·°í‹°ë””ë°”ì´ìŠ¤-ê¸°íƒ€ ë””ë°”ì´ìŠ¤": ["ë·°í‹°ë””ë°”ì´ìŠ¤"],

            # ë°˜ë ¤ë™ë¬¼ìš©í’ˆ - ê°•ì•„ì§€
            "ë°˜ë ¤ë™ë¬¼ìš©í’ˆ-ê°•ì•„ì§€-ë¯¸ìš©/ê´€ë¦¬": ["ê°•ì•„ì§€ë¯¸ìš©", "ê°•ì•„ì§€ ë¯¸ìš©", "ë°˜ë ¤ê²¬ë¯¸ìš©", "ì´ì–´í´ë¦¬ë„ˆ"],
            "ë°˜ë ¤ë™ë¬¼ìš©í’ˆ-ê°•ì•„ì§€-ëª©ìš•/ìœ„ìƒ": ["ê°•ì•„ì§€ìƒ´í‘¸", "ê°•ì•„ì§€ ìƒ´í‘¸", "ë°˜ë ¤ê²¬ìƒ´í‘¸"],
            "ë°˜ë ¤ë™ë¬¼ìš©í’ˆ-ê°•ì•„ì§€-ë°°ë³€ìš©í’ˆ": ["ë°°ë³€íŒ¨ë“œ", "ë°°ë³€ íŒ¨ë“œ"],
            "ë°˜ë ¤ë™ë¬¼ìš©í’ˆ-ê°•ì•„ì§€-ì‹¤ë‚´ìš©í’ˆ/ì¥ë‚œê°": ["ê°•ì•„ì§€ì¥ë‚œê°", "ê°•ì•„ì§€ ì¥ë‚œê°", "ë…¸ë˜ë°© í† ì´", "ë…¸ì¦ˆì›Œí¬"],
            "ë°˜ë ¤ë™ë¬¼ìš©í’ˆ-ê°•ì•„ì§€-íŒ¨ì…˜/ì™¸ì¶œìš©í’ˆ": ["ê°•ì•„ì§€ì˜·", "ê°•ì•„ì§€ ì˜·", "ìŠ¬ë§ë°±"],
            "ë°˜ë ¤ë™ë¬¼ìš©í’ˆ-ê°•ì•„ì§€-ê¸°íƒ€": ["í•˜ìš°ìŠ¤", "ëŒ•êµ´í•˜ìš°ìŠ¤", "í«í•˜ìš°ìŠ¤"],

            # ë°˜ë ¤ë™ë¬¼ìš©í’ˆ - ê³ ì–‘ì´
            "ë°˜ë ¤ë™ë¬¼ìš©í’ˆ-ê³ ì–‘ì´-ë¯¸ìš©/ê´€ë¦¬": ["ê³ ì–‘ì´ë¯¸ìš©", "ê³ ì–‘ì´ ë¯¸ìš©", "ë°˜ë ¤ë¬˜ë¯¸ìš©"],
            "ë°˜ë ¤ë™ë¬¼ìš©í’ˆ-ê³ ì–‘ì´-ëª©ìš•/ìœ„ìƒ": ["ê³ ì–‘ì´ìƒ´í‘¸", "ê³ ì–‘ì´ ìƒ´í‘¸", "ë°˜ë ¤ë¬˜ìƒ´í‘¸"],
            "ë°˜ë ¤ë™ë¬¼ìš©í’ˆ-ê³ ì–‘ì´-ë°°ë³€ìš©í’ˆ": ["ê³ ì–‘ì´ëª¨ë˜", "ê³ ì–‘ì´ ëª¨ë˜"],
            "ë°˜ë ¤ë™ë¬¼ìš©í’ˆ-ê³ ì–‘ì´-ì‹¤ë‚´ìš©í’ˆ/ì¥ë‚œê°": ["ê³ ì–‘ì´ì¥ë‚œê°", "ê³ ì–‘ì´ ì¥ë‚œê°"],
            "ë°˜ë ¤ë™ë¬¼ìš©í’ˆ-ê³ ì–‘ì´-íŒ¨ì…˜/ì™¸ì¶œìš©í’ˆ": ["ê³ ì–‘ì´ì˜·", "ê³ ì–‘ì´ ì˜·"],
            "ë°˜ë ¤ë™ë¬¼ìš©í’ˆ-ê³ ì–‘ì´-ê¸°íƒ€": ["ìº£íƒ€ì›Œ", "ìŠ¤í¬ë˜ì³"],

            # ë°˜ë ¤ë™ë¬¼ìš©í’ˆ - ê³µí†µ
            "ë°˜ë ¤ë™ë¬¼ìš©í’ˆ-ì‹ê¸°": ["ë°˜ë ¤ë™ë¬¼ ì‹ê¸°", "í« ì‹ê¸°", "ì„¸ë¼ë¯¹ ì‹ê¸°"],

            # ìƒí™œìš©í’ˆ - ì£¼ë°©/ì‹ê¸°
            "ìƒí™œìš©í’ˆ-ì£¼ë°©/ì‹ê¸°-ì‹ê¸°ë¥˜": ["ìŠ¤í‘¼", "í¬í¬", "í‹°ìŠ¤í‘¼", "í‹°í¬í¬", "ë””ì €íŠ¸ ìŠ¤í‘¼", "ë¡±ë“œë§í¬ ìŠ¤í‘¼", "ì–‘ì‹í‹°ìŠ¤í‘¼", "ì–‘ì‹í‹°í¬í¬", "ë©”ì‰¬ ìŠ¤í‘¼"],
            "ìƒí™œìš©í’ˆ-ì£¼ë°©/ì‹ê¸°-í‹°ì›¨ì–´": ["í‹°íŒŸ", "í‹°íŠ¸ë ˆì´"],
            "ìƒí™œìš©í’ˆ-ì£¼ë°©/ì‹ê¸°-ì»µ/ë¨¸ê·¸": ["ë¨¸ê·¸ì»µ", "ë¨¸ê·¸"],
            "ìƒí™œìš©í’ˆ-ì£¼ë°©/ì‹ê¸°-ìœ ê¸°": ["ìœ ê¸°", "ë°©ì§œìœ ê¸°"],
            "ìƒí™œìš©í’ˆ-ì£¼ë°©/ì‹ê¸°-ì£¼ë°©ìš©í’ˆ": ["ìˆ˜ì„¸ë¯¸", "ìœ ê¸° ì „ìš© ìˆ˜ì„¸ë¯¸", "êµ¬ë¦¬ë¹¨ëŒ€", "ë¹¨ëŒ€"],
            "ìƒí™œìš©í’ˆ-ì£¼ë°©/ì‹ê¸°-í…Œì´ë¸”ì›¨ì–´": ["ìŠ¤ì¹´í”„", "ë‹¤ì´ë‹ ìŠ¤ì¹´í”„", "ë‹¤ì´ë‹ ì‹ê¸°", "í…Œì´ë¸” ì„¸íŠ¸"],

            # ìƒí™œìš©í’ˆ - ê°€ì „ì œí’ˆ
            "ìƒí™œìš©í’ˆ-ê°€ì „-ì²­ì†Œê¸°": ["ì²­ì†Œê¸°", "ì¹¨êµ¬ì²­ì†Œê¸°", "ìš•ì‹¤ì²­ì†Œê¸°"],
            "ìƒí™œìš©í’ˆ-ê°€ì „-ì£¼ë°©ê°€ì „": ["ë¯¹ì„œê¸°", "í…€ë¸”ë Œë”", "ë¸”ë Œë”", "ìš”ê±°íŠ¸ ë©”ì´ì»¤"],
            "ìƒí™œìš©í’ˆ-ê°€ì „-í…€ë¸”ëŸ¬": ["í…€ë¸”ëŸ¬", "ìŠ¤í… í…€ë¸”ëŸ¬", "íˆ¬ì›¨ì´ í…€ë¸”ëŸ¬"],
            "ìƒí™œìš©í’ˆ-ê°€ì „-ë‚œë°©ê¸°ê¸°": ["íˆí„°", "ì˜¨í’ê¸°", "ì „ê¸° íˆí„°", "ë²½ë‚œë¡œ", "ë‚œë¡œ"],
            "ìƒí™œìš©í’ˆ-ê°€ì „-ê°€ìŠµê¸°": ["ê°€ìŠµê¸°", "ê¸°í™”ì‹ ê°€ìŠµê¸°", "ê°€ì—´ì‹ ê°€ìŠµê¸°"],
            "ìƒí™œìš©í’ˆ-ê°€ì „-ì œìŠµê¸°": ["ì œìŠµê¸°", "ë¯¸ë‹ˆ ì œìŠµê¸°", "ìŠµê¸°ì œê±°"],
            "ìƒí™œìš©í’ˆ-ê°€ì „-ì„ í’ê¸°": ["ì„ í’ê¸°", "ì¨í˜ë ˆì´í„°", "ì„œí˜ë ˆì´í„°", "ë¬´í’ ì„ í’ê¸°", "ë‚ ê°œì—†ëŠ” ì„ í’ê¸°"],
            "ìƒí™œìš©í’ˆ-ê°€ì „-ë‹¤ë¦¬ë¯¸": ["ë‹¤ë¦¬ë¯¸", "ìŠ¤íŒ€ë‹¤ë¦¬ë¯¸", "ìŠ¤í‹°ë¨¸", "í•¸ë””í˜• ìŠ¤íŒ€ë‹¤ë¦¬ë¯¸"],
            "ìƒí™œìš©í’ˆ-ê°€ì „-ìƒí™œê°€ì „": ["ë³´í’€ì œê±°ê¸°", "ì“°ë ˆê¸°í†µ", "ìë™ ì“°ë ˆê¸°í†µ"],

            # ìƒí™œìš©í’ˆ - íŒ¨ì…˜ì†Œí’ˆ
            "ìƒí™œìš©í’ˆ-íŒ¨ì…˜ì†Œí’ˆ-íŒ¨ì…˜ì¡í™”": ["íŒ¨ë”© ì¼€ì´í”„", "ì¼€ì´í”„", "ìŠ¤ì¹´í”„"],
            "ìƒí™œìš©í’ˆ-íŒ¨ì…˜ì†Œí’ˆ-ì–‘ë§": ["ìˆ˜ë©´ì–‘ë§", "ì–‘ë§"],

            # ìƒí™œìš©í’ˆ - ìºë¦­í„° êµ¿ì¦ˆ
            "ìƒí™œìš©í’ˆ-ìºë¦­í„°êµ¿ì¦ˆ-ìŠ¤í‹°ì»¤": ["ìŠ¤í‹°ì»¤"],
            "ìƒí™œìš©í’ˆ-ìºë¦­í„°êµ¿ì¦ˆ-íŒŒìš°ì¹˜": ["íŒŒìš°ì¹˜", "ì¸í˜•íŒŒìš°ì¹˜", "ìŠ¤íŠ¸ë§ íŒŒìš°ì¹˜"],
            "ìƒí™œìš©í’ˆ-ìºë¦­í„°êµ¿ì¦ˆ-ì¸í˜•": ["ì¸í˜•", "ìºë¦­í„°ì¸í˜•", "ìºë¦­í„° ì¸í˜•", "ì¸í˜•í‚¤ë§"],
            "ìƒí™œìš©í’ˆ-ìºë¦­í„°êµ¿ì¦ˆ-í‚¤ë§": ["í‚¤ë§", "ì¸í˜• í‚¤ë§", "ì§€ë¹„ì¸ "],
            "ìƒí™œìš©í’ˆ-ìºë¦­í„°êµ¿ì¦ˆ-ìƒí™œì†Œí’ˆ": ["ë¬´ë¦ë‹´ìš”", "ë‹´ìš”", "ë§ˆìš°ìŠ¤íŒ¨ë“œ"],
        }

    def _build_ingredient_keywords(self) -> Dict[str, List[str]]:
        """ì„±ë¶„ë³„ í‚¤ì›Œë“œ ë§µí•‘"""
        return {
            "íˆì•Œë£¨ë¡ ì‚°": ["íˆì•Œë£¨ë¡ ì‚°", "íˆì•Œë£¨ë¡œë‹‰", "HA"],
            "ë‚˜ì´ì•„ì‹ ì•„ë§ˆì´ë“œ": ["ë‚˜ì´ì•„ì‹ ", "ë‹ˆì•„ì‹ ", "niacinamide"],
            "ë ˆí‹°ë†€": ["ë ˆí‹°ë†€", "retinol"],
            "ë¹„íƒ€ë¯¼C": ["ë¹„íƒ€ë¯¼C", "ë¹„íƒ€ë¯¼ì”¨", "ì•„ìŠ¤ì½”ë¥´ë¹…", "vitamin C"],
            "ì„¼í…”ë¼": ["ì„¼í…”ë¼", "ì‹œì¹´", "cica", "ë³‘í’€"],
            "ì„¸ë¼ë§ˆì´ë“œ": ["ì„¸ë¼ë§ˆì´ë“œ", "ceramide"],
            "í©íƒ€ì´ë“œ": ["í©íƒ€ì´ë“œ", "peptide"],
            "AHA": ["AHA", "ê¸€ë¦¬ì½œë¦­", "ì –ì‚°", "glycolic"],
            "BHA": ["BHA", "ì‚´ë¦¬ì‹¤ì‚°", "salicylic"],
            "ì•Œë¡œì—": ["ì•Œë¡œì—"],
            "íŒí…Œë†€": ["íŒí…Œë†€", "panthenol"],
            "ì½œë¼ê²": ["ì½œë¼ê²", "collagen"],
        }

    def _build_concern_keywords(self) -> Dict[str, List[str]]:
        """í”¼ë¶€ ê³ ë¯¼ë³„ í‚¤ì›Œë“œ ë§µí•‘"""
        return {
            "ì£¼ë¦„ê°œì„ ": ["ì£¼ë¦„", "ë§í´", "wrinkle", "íƒ„ë ¥", "ì•ˆí‹°ì—ì´ì§•"],
            "ë¯¸ë°±": ["ë¯¸ë°±", "í™”ì´íŠ¸ë‹", "whitening", "ë¸Œë¼ì´íŠ¸", "ë°ì€"],
            "ë³´ìŠµ": ["ë³´ìŠµ", "ìˆ˜ë¶„", "ëª¨ì´ìŠ¤ì²˜", "moisture", "íˆë“œë¼"],
            "ëª¨ê³µì¼€ì–´": ["ëª¨ê³µ", "pore"],
            "íŠ¸ëŸ¬ë¸”ì¼€ì–´": ["íŠ¸ëŸ¬ë¸”", "ì—¬ë“œë¦„", "ì§„ì •", "ìˆ˜ë”©", "soothing"],
            "ë¯¼ê°": ["ë¯¼ê°", "sensitive", "ì„¼ì‹œí‹°ë¸Œ"],
            "ê°ì§ˆ": ["ê°ì§ˆ", "í•„ë§", "peeling"],
            "íƒ„ë ¥": ["íƒ„ë ¥", "ë¦¬í”„íŒ…", "lifting", "í¼ë°"],
        }

    def tag_product(self, product: Dict) -> Dict:
        """
        ìƒí’ˆ ë°ì´í„°ì— íƒœê·¸ ìë™ ë¶€ì—¬

        Args:
            product: ìƒí’ˆ ì •ë³´ ë”•ì…”ë„ˆë¦¬

        Returns:
            íƒœê·¸ê°€ ì¶”ê°€ëœ ìƒí’ˆ ë”•ì…”ë„ˆë¦¬
        """
        tags = {
            "category_tags": [],
            "ingredient_tags": [],
            "concern_tags": [],
            "feature_tags": [],
            "texture_tags": [],
            "scent_tags": [],
        }

        # ìƒí’ˆëª…ê³¼ ë¸Œëœë“œ ê²°í•©
        text = f"{product.get('ë¸Œëœë“œ', '')} {product.get('ìƒí’ˆëª…', '')}".lower()

        # 1. ì¹´í…Œê³ ë¦¬ íƒœê·¸ ì¶”ì¶œ
        tags["category_tags"] = self._extract_category_tags(text)

        # 2. ì„±ë¶„ íƒœê·¸ ì¶”ì¶œ
        tags["ingredient_tags"] = self._extract_ingredient_tags(text)

        # 3. í”¼ë¶€ ê³ ë¯¼ íƒœê·¸ ì¶”ì¶œ
        tags["concern_tags"] = self._extract_concern_tags(text)

        # 4. íŠ¹ì§• íƒœê·¸ ì¶”ì¶œ
        tags["feature_tags"] = self._extract_feature_tags(text)

        # 5. ì œí˜• íƒœê·¸ ì¶”ì¶œ
        tags["texture_tags"] = self._extract_texture_tags(text)

        # 6. í–¥ íƒœê·¸ ì¶”ì¶œ
        tags["scent_tags"] = self._extract_scent_tags(text)

        # 7. êµ¬ë§¤ì í†µê³„ ê¸°ë°˜ íƒœê·¸ ì¶”ê°€
        buyer_stats = product.get("êµ¬ë§¤ì_í†µê³„") or {}
        tags["target_demographics"] = self._extract_demographics_tags(buyer_stats)

        # ì›ë³¸ ìƒí’ˆ ë°ì´í„°ì— íƒœê·¸ ì¶”ê°€
        product_with_tags = product.copy()
        product_with_tags["tags"] = tags

        return product_with_tags

    def _extract_category_tags(self, text: str) -> List[str]:
        """ì¹´í…Œê³ ë¦¬ íƒœê·¸ ì¶”ì¶œ"""
        tags = set()

        # ë·°í‹°ë””ë°”ì´ìŠ¤/ê¸°ê¸°ë¥˜ ì œí’ˆì¸ì§€ ë¨¼ì € í™•ì¸
        device_keywords = ["ê³ ë°ê¸°", "ë“œë¼ì´ê¸°", "ì•„ì´ë¡±", "ë””ë°”ì´ìŠ¤", "ê¸°ê¸°", "ë¸ŒëŸ¬ì‰¬", "ì¹«ì†”", "í´ë Œì§•ë¸ŒëŸ¬ì‰¬", "ì•ˆë§ˆê¸°", "ë§ˆì‚¬ì§€ê¸°", "ìŠ¤í…í¼", "ìš´ë™ê¸°êµ¬", "ì²­ì†Œê¸°", "ë¯¹ì„œê¸°", "ë¸”ë Œë”", "íˆí„°", "ì˜¨í’ê¸°", "ê°€ìŠµê¸°", "ì œìŠµê¸°", "ì„ í’ê¸°", "ì¨í˜ë ˆì´í„°", "ë‹¤ë¦¬ë¯¸", "ìŠ¤í‹°ë¨¸", "ë³´í’€ì œê±°ê¸°"]
        is_device = any(keyword in text for keyword in device_keywords)

        # ì˜ë£Œìš©í’ˆ/íŠ¹ìˆ˜ìš©í’ˆ í‚¤ì›Œë“œ í™•ì¸
        special_keywords = ["íŒŒìŠ¤", "ì•„ì´ì˜¨íŒ©", "í”¼íŒ…", "ì••ë°•ë°´ë“œ", "í•˜ìš°ìŠ¤", "ë…¸ë˜ë°© í† ì´", "ì‹ê¸°"]
        is_special = any(keyword in text for keyword in special_keywords)

        # ì£¼ë°©/ì‹ê¸°/ìƒí™œìš©í’ˆ í‚¤ì›Œë“œ í™•ì¸
        kitchen_keywords = ["ìŠ¤í‘¼", "í¬í¬", "í‹°ìŠ¤í‘¼", "í‹°í¬í¬", "í‹°íŒŸ", "ë¨¸ê·¸ì»µ", "ë¨¸ê·¸", "ìœ ê¸°", "ë°©ì§œìœ ê¸°", "ìˆ˜ì„¸ë¯¸", "ë¹¨ëŒ€", "êµ¬ë¦¬ë¹¨ëŒ€", "íŠ¸ë ˆì´", "í…€ë¸”ëŸ¬", "ì“°ë ˆê¸°í†µ"]
        is_kitchen = any(keyword in text for keyword in kitchen_keywords)

        # íŒ¨ì…˜/ì˜ë¥˜ í‚¤ì›Œë“œ í™•ì¸
        fashion_keywords = ["íŒ¨ë”©", "ì¼€ì´í”„", "ìŠ¤ì¹´í”„", "ì–‘ë§"]
        is_fashion = any(keyword in text for keyword in fashion_keywords)

        # ìºë¦­í„° êµ¿ì¦ˆ í‚¤ì›Œë“œ í™•ì¸
        goods_keywords = ["ìŠ¤í‹°ì»¤", "íŒŒìš°ì¹˜", "ì¸í˜•", "í‚¤ë§", "ë‹´ìš”", "ë§ˆìš°ìŠ¤íŒ¨ë“œ", "ì§€ë¹„ì¸ "]
        is_goods = any(keyword in text for keyword in goods_keywords)

        for category, keywords in self.category_keywords.items():
            for keyword in keywords:
                if keyword.lower() in text:
                    # ê¸°ê¸°ë¥˜ ì œí’ˆì¸ ê²½ìš°, í™”ì¥í’ˆ ì¹´í…Œê³ ë¦¬ëŠ” ì œì™¸
                    if is_device:
                        # ê¸°ê¸°, ë„êµ¬, ë°˜ë ¤ë™ë¬¼, ê°€ì „ ê´€ë ¨ ì¹´í…Œê³ ë¦¬ë§Œ ì¶”ê°€
                        if any(device_cat in category for device_cat in ["ê¸°ê¸°", "ë¸ŒëŸ¬ì‰¬", "ì¹«ì†”", "ê°•ì•„ì§€", "ê³ ì–‘ì´", "ë„êµ¬", "ë””í“¨ì €", "ìº”ë“¤", "ë°˜ë ¤ë™ë¬¼", "ê°€ì „"]):
                            tags.add(category)
                            break
                    # ì£¼ë°©/ì‹ê¸° ì œí’ˆì¸ ê²½ìš°, ìƒí™œìš©í’ˆ-ì£¼ë°©/ì‹ê¸° ì¹´í…Œê³ ë¦¬ë§Œ ì¶”ê°€
                    elif is_kitchen:
                        if any(kitchen_cat in category for kitchen_cat in ["ì£¼ë°©/ì‹ê¸°", "ê°€ì „"]):
                            tags.add(category)
                            break
                    # íŒ¨ì…˜ ì œí’ˆì¸ ê²½ìš°, íŒ¨ì…˜ì†Œí’ˆ ì¹´í…Œê³ ë¦¬ë§Œ ì¶”ê°€
                    elif is_fashion:
                        if "íŒ¨ì…˜ì†Œí’ˆ" in category:
                            tags.add(category)
                            break
                    # ìºë¦­í„° êµ¿ì¦ˆì¸ ê²½ìš°, ìºë¦­í„°êµ¿ì¦ˆ ì¹´í…Œê³ ë¦¬ë§Œ ì¶”ê°€
                    elif is_goods:
                        if "ìºë¦­í„°êµ¿ì¦ˆ" in category:
                            tags.add(category)
                            break
                    # íŠ¹ìˆ˜ìš©í’ˆì¸ ê²½ìš°, í•´ë‹¹ ì¹´í…Œê³ ë¦¬ë§Œ ì¶”ê°€
                    elif is_special:
                        if any(special_cat in category for special_cat in ["ì˜ë£Œìš©í’ˆ", "ê°•ì•„ì§€", "ê³ ì–‘ì´", "ë°˜ë ¤ë™ë¬¼"]):
                            tags.add(category)
                            break
                    else:
                        tags.add(category)
                        break
        return list(tags)

    def _extract_ingredient_tags(self, text: str) -> List[str]:
        """ì„±ë¶„ íƒœê·¸ ì¶”ì¶œ"""
        tags = set()
        for ingredient, keywords in self.ingredient_keywords.items():
            for keyword in keywords:
                if keyword.lower() in text:
                    tags.add(ingredient)
                    break
        return list(tags)

    def _extract_concern_tags(self, text: str) -> List[str]:
        """í”¼ë¶€ ê³ ë¯¼ íƒœê·¸ ì¶”ì¶œ"""
        tags = set()
        for concern, keywords in self.concern_keywords.items():
            for keyword in keywords:
                if keyword.lower() in text:
                    tags.add(concern)
                    break
        return list(tags)

    def _extract_feature_tags(self, text: str) -> List[str]:
        """íŠ¹ì§• íƒœê·¸ ì¶”ì¶œ"""
        features = set()

        feature_keywords = {
            "ì €ìê·¹": ["ì €ìê·¹", "ë§ˆì¼ë“œ", "mild"],
            "ë¬´í–¥": ["ë¬´í–¥", "í–¥ì—†ëŠ”"],
            "ë¬´ì•Œì½”ì˜¬": ["ë¬´ì•Œì½”ì˜¬", "ì•Œì½”ì˜¬í”„ë¦¬"],
            "ë¹„ê±´": ["ë¹„ê±´", "vegan"],
            "ì›Œí„°í”„ë£¨í”„": ["ì›Œí„°í”„ë£¨í”„", "waterproof", "ë°©ìˆ˜"],
            "ë¡±ë˜ìŠ¤íŒ…": ["ë¡±ë˜ìŠ¤íŒ…", "ì§€ì†", "24ì‹œê°„"],
            "ì´‰ì´‰": ["ì´‰ì´‰", "ëª¨ì´ìŠ¤íŠ¸"],
            "ì‚°ëœ»": ["ì‚°ëœ»", "í”„ë ˆì‹œ", "fresh"],
        }

        for feature, keywords in feature_keywords.items():
            for keyword in keywords:
                if keyword.lower() in text:
                    features.add(feature)
                    break

        return list(features)

    def _extract_texture_tags(self, text: str) -> List[str]:
        """ì œí˜• íƒœê·¸ ì¶”ì¶œ (í™”ì¥í’ˆ ì œí’ˆë§Œ)"""
        textures = set()

        # í™”ì¥í’ˆì´ ì•„ë‹Œ ì œí’ˆ í‚¤ì›Œë“œ ì²´í¬ (ê¸°ê¸°ë¥˜, ë„êµ¬ë¥˜, ì£¼ë°©ìš©í’ˆ, ê°€ì „ì œí’ˆ, íŒ¨ì…˜ìš©í’ˆ, ìºë¦­í„°êµ¿ì¦ˆ ë“±)
        non_cosmetic_keywords = [
            "ê³ ë°ê¸°", "ë“œë¼ì´ê¸°", "ì•„ì´ë¡±", "ë””ë°”ì´ìŠ¤", "ê¸°ê¸°",
            "ë¸ŒëŸ¬ì‰¬", "ë¸ŒëŸ¬ì‹œ", "ì¹«ì†”", "ë„êµ¬", "ìº”ë“¤", "ë””í“¨ì €",
            "ìŠ¤í‘¼", "í¬í¬", "í‹°ìŠ¤í‘¼", "í‹°í¬í¬", "í‹°íŒŸ", "ë¨¸ê·¸ì»µ", "ë¨¸ê·¸", "ìœ ê¸°", "ë°©ì§œìœ ê¸°", "ìˆ˜ì„¸ë¯¸", "ë¹¨ëŒ€", "êµ¬ë¦¬ë¹¨ëŒ€", "íŠ¸ë ˆì´", "í…€ë¸”ëŸ¬",
            "ì²­ì†Œê¸°", "ë¯¹ì„œê¸°", "ë¸”ë Œë”", "íˆí„°", "ì˜¨í’ê¸°", "ê°€ìŠµê¸°", "ì œìŠµê¸°", "ì„ í’ê¸°", "ì¨í˜ë ˆì´í„°", "ë‹¤ë¦¬ë¯¸", "ìŠ¤í‹°ë¨¸", "ë³´í’€ì œê±°ê¸°", "ì“°ë ˆê¸°í†µ",
            "íŒ¨ë”©", "ì¼€ì´í”„", "ìŠ¤ì¹´í”„", "ì˜ë¥˜", "ì˜·", "ì–‘ë§",
            "ìŠ¤í‹°ì»¤", "íŒŒìš°ì¹˜", "ì¸í˜•", "í‚¤ë§", "ë‹´ìš”", "ë§ˆìš°ìŠ¤íŒ¨ë“œ", "ì§€ë¹„ì¸ "
        ]

        # í™”ì¥í’ˆì´ ì•„ë‹Œ ì œí’ˆì´ë©´ ì œí˜• íƒœê·¸ë¥¼ ë¶™ì´ì§€ ì•ŠìŒ
        for keyword in non_cosmetic_keywords:
            if keyword in text:
                return []

        texture_keywords = {
            "ì›Œí„°íƒ€ì…": ["ì›Œí„°íƒ€ì…", "ë¬¼íƒ€ì…"],
            "ì ¤íƒ€ì…": ["ì ¤íƒ€ì…", "ì ¤ íƒ€ì…", "gel"],
            "í¬ë¦¼íƒ€ì…": ["í¬ë¦¼íƒ€ì…", "í¬ë¦¼ íƒ€ì…"],
            "ë°¤íƒ€ì…": ["ë°¤íƒ€ì…", "ë°¤ íƒ€ì…", "balm"],
            "ì˜¤ì¼íƒ€ì…": ["ì˜¤ì¼íƒ€ì…", "ì˜¤ì¼ íƒ€ì…"],
            "ì—ì„¼ìŠ¤íƒ€ì…": ["ì—ì„¼ìŠ¤íƒ€ì…", "ì„¸ëŸ¼íƒ€ì…"],
            "ê°€ë²¼ìš´ì œí˜•": ["ê°€ë²¼ìš´ ì œí˜•", "ë¼ì´íŠ¸"],
        }

        for texture, keywords in texture_keywords.items():
            for keyword in keywords:
                if keyword.lower() in text:
                    textures.add(texture)
                    break

        return list(textures)

    def _extract_scent_tags(self, text: str) -> List[str]:
        """í–¥ íƒœê·¸ ì¶”ì¶œ"""
        scents = set()

        scent_keywords = {
            "ë¬´í–¥": ["ë¬´í–¥", "í–¥ì—†ëŠ”"],
            "í”Œë¡œëŸ´": ["í”Œë¡œëŸ´", "ê½ƒ", "ë¡œì¦ˆ", "ë¼ë²¤ë”"],
            "ì‹œíŠ¸ëŸ¬ìŠ¤": ["ì‹œíŠ¸ëŸ¬ìŠ¤", "ë ˆëª¬", "ì˜¤ë Œì§€", "ìëª½"],
            "í”„ë£¨í‹°": ["í”¼ì¹˜", "ë³µìˆ­ì•„", "ë² ë¦¬", "ì²´ë¦¬"],
            "í—ˆë¸Œ": ["í—ˆë¸Œ", "ë¯¼íŠ¸", "í‹°íŠ¸ë¦¬"],
        }

        for scent, keywords in scent_keywords.items():
            for keyword in keywords:
                if keyword.lower() in text:
                    scents.add(scent)
                    break

        return list(scents)

    def _extract_demographics_tags(self, buyer_stats: Dict) -> Dict:
        """êµ¬ë§¤ì í†µê³„ ê¸°ë°˜ íƒ€ê²Ÿ ì¸êµ¬í†µê³„ ì¶”ì¶œ"""
        demographics = {
            "age_groups": [],
            "skin_types": []
        }

        # ì—°ë ¹ëŒ€ë³„ í†µê³„
        age_stats = buyer_stats.get("ì—°ë ¹ëŒ€ë³„", {})
        if age_stats:
            # ìƒìœ„ 2ê°œ ì—°ë ¹ëŒ€ ì¶”ì¶œ
            sorted_ages = sorted(age_stats.items(), key=lambda x: x[1], reverse=True)
            demographics["age_groups"] = [age for age, _ in sorted_ages[:2] if age]

        # í”¼ë¶€íƒ€ì…ë³„ í†µê³„
        skin_stats = buyer_stats.get("í”¼ë¶€íƒ€ì…ë³„", {})
        if skin_stats:
            # ìƒìœ„ 2ê°œ í”¼ë¶€íƒ€ì… ì¶”ì¶œ
            sorted_skins = sorted(skin_stats.items(), key=lambda x: x[1], reverse=True)
            demographics["skin_types"] = [skin for skin, _ in sorted_skins[:2] if skin]

        return demographics


def process_jsonl_file(input_path: str, output_path: str, missing_output_path: str = None):
    """
    JSONL íŒŒì¼ì˜ ëª¨ë“  ìƒí’ˆì— íƒœê·¸ ë¶€ì—¬

    Args:
        input_path: ì…ë ¥ JSONL íŒŒì¼ ê²½ë¡œ
        output_path: ì¶œë ¥ JSONL íŒŒì¼ ê²½ë¡œ
        missing_output_path: ì¹´í…Œê³ ë¦¬ íƒœê·¸ê°€ ì—†ëŠ” ìƒí’ˆ ì €ì¥ ê²½ë¡œ (ì„ íƒ)
    """
    tagger = ProductTagger()
    tagged_products = []
    missing_products = []
    skipped_count = 0

    print(f"ğŸ“ íŒŒì¼ ì½ê¸°: {input_path}")

    with open(input_path, 'r', encoding='utf-8') as f:
        for i, line in enumerate(f, 1):
            try:
                product = json.loads(line.strip())

                # ìƒí’ˆìƒì„¸_ì´ë¯¸ì§€ í•„í„°ë§ (ë¸Œëœë“œë³„ ì¡°ê±´)
                detail_images = product.get('ìƒí’ˆìƒì„¸_ì´ë¯¸ì§€', [])
                brand = product.get('ë¸Œëœë“œ', '')

                if detail_images:
                    filtered_images = []

                    for img in detail_images:
                        img_lower = img.lower()

                        # https://images-kr.amoremall.com/ ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ê²½ìš°: detailë§Œ í¬í•¨
                        if img.startswith('https://images-kr.amoremall.com/'):
                            if 'detail' in img_lower:
                                filtered_images.append(img)

                        # ì„¸ì”ëŠ ë¸Œëœë“œ: detailë§Œ í¬í•¨
                        elif brand == 'ì„¸ì”ëŠ':
                            if 'detail' in img_lower:
                                filtered_images.append(img)

                        # ì•„ëª¨ìŠ¤ í”„ë¡œí˜ì…”ë„: notice ì œì™¸
                        elif brand == 'ì•„ëª¨ìŠ¤ í”„ë¡œí˜ì…”ë„':
                            if 'notice' not in img_lower:
                                filtered_images.append(img)

                        # ê¸€ë¨íŒœ ë¸Œëœë“œ: ìˆ«ìê°€ í¬í•¨ëœ ì´ë¯¸ì§€ë§Œ í¬í•¨
                        elif brand == 'ê¸€ë¨íŒœ':
                            import re
                            if re.search(r'\d', img):
                                filtered_images.append(img)

                        # ê·¸ ì™¸ ë¸Œëœë“œ: ëª¨ë“  ì´ë¯¸ì§€ í¬í•¨
                        else:
                            filtered_images.append(img)

                    product['ìƒí’ˆìƒì„¸_ì´ë¯¸ì§€'] = filtered_images

                # í•„í„°ë§ëœ ì´ë¯¸ì§€ê°€ ì—†ìœ¼ë©´ ìŠ¤í‚µ
                if not product.get('ìƒí’ˆìƒì„¸_ì´ë¯¸ì§€') or len(product.get('ìƒí’ˆìƒì„¸_ì´ë¯¸ì§€', [])) == 0:
                    skipped_count += 1
                    continue

                tagged_product = tagger.tag_product(product)
                tagged_products.append(tagged_product)

                # ì¹´í…Œê³ ë¦¬ íƒœê·¸ê°€ ì—†ëŠ” ìƒí’ˆ ë³„ë„ ì €ì¥
                if not tagged_product.get('tags', {}).get('category_tags', []):
                    missing_products.append(tagged_product)

                if i % 50 == 0:
                    print(f"âœ… {i}ê°œ ìƒí’ˆ ì²˜ë¦¬ ì™„ë£Œ (íƒœê¹…: {len(tagged_products)}ê°œ, ìŠ¤í‚µ: {skipped_count}ê°œ)")

            except json.JSONDecodeError as e:
                print(f"âš ï¸ JSON íŒŒì‹± ì˜¤ë¥˜ (line {i}): {e}")
                continue

    print(f"\nğŸ’¾ íƒœê·¸ëœ ìƒí’ˆ ì €ì¥: {output_path}")

    with open(output_path, 'w', encoding='utf-8') as f:
        for product in tagged_products:
            f.write(json.dumps(product, ensure_ascii=False) + '\n')

    print(f"âœ… ì™„ë£Œ! {len(tagged_products)}ê°œ ìƒí’ˆ íƒœê¹… ì™„ë£Œ (ìŠ¤í‚µ: {skipped_count}ê°œ)")

    # ì¹´í…Œê³ ë¦¬ íƒœê·¸ ëˆ„ë½ ìƒí’ˆ ì €ì¥
    if missing_output_path and missing_products:
        print(f"\nğŸ’¾ ì¹´í…Œê³ ë¦¬ ëˆ„ë½ ìƒí’ˆ ì €ì¥: {missing_output_path}")
        with open(missing_output_path, 'w', encoding='utf-8') as f:
            for product in missing_products:
                f.write(json.dumps(product, ensure_ascii=False) + '\n')
        print(f"âœ… {len(missing_products)}ê°œ ëˆ„ë½ ìƒí’ˆ ì €ì¥ ì™„ë£Œ")

    # í†µê³„ ì¶œë ¥
    _print_tagging_stats(tagged_products)


def _print_tagging_stats(products: List[Dict]):
    """íƒœê¹… í†µê³„ ì¶œë ¥"""
    print("\n" + "="*50)
    print("ğŸ“Š íƒœê¹… í†µê³„")
    print("="*50)

    all_category_tags = set()
    all_ingredient_tags = set()
    all_concern_tags = set()

    for product in products:
        tags = product.get("tags", {})
        all_category_tags.update(tags.get("category_tags", []))
        all_ingredient_tags.update(tags.get("ingredient_tags", []))
        all_concern_tags.update(tags.get("concern_tags", []))

    print(f"ì´ ìƒí’ˆ ìˆ˜: {len(products)}")
    print(f"ì¹´í…Œê³ ë¦¬ íƒœê·¸ ì¢…ë¥˜: {len(all_category_tags)}ê°œ")
    print(f"  - {', '.join(sorted(all_category_tags))}")
    print(f"ì„±ë¶„ íƒœê·¸ ì¢…ë¥˜: {len(all_ingredient_tags)}ê°œ")
    print(f"  - {', '.join(sorted(all_ingredient_tags))}")
    print(f"í”¼ë¶€ê³ ë¯¼ íƒœê·¸ ì¢…ë¥˜: {len(all_concern_tags)}ê°œ")
    print(f"  - {', '.join(sorted(all_concern_tags))}")


if __name__ == "__main__":
    import sys
    import os

    # Windows ì½˜ì†” ì¸ì½”ë”© ì„¤ì •
    if sys.platform == 'win32':
        try:
            sys.stdout.reconfigure(encoding='utf-8')
        except:
            pass

    # ì…ë ¥ íŒŒì¼ ê²½ë¡œ
    input_file = "c:/Users/82104/Desktop/vscode/AI-INNOVATION-CHALLENGE-2026/data/crawling_result/product_crawling_data.jsonl"
    output_file = "c:/Users/82104/Desktop/vscode/AI-INNOVATION-CHALLENGE-2026/data/crawling_result/product_crawling_tagged.jsonl"
    missing_file = "c:/Users/82104/Desktop/vscode/AI-INNOVATION-CHALLENGE-2026/data/crawling_result/product_crawling_missing_tags.jsonl"

    if not os.path.exists(input_file):
        print(f"âŒ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {input_file}")
        sys.exit(1)

    process_jsonl_file(input_file, output_file, missing_file)

    # ìƒ˜í”Œ ì¶œë ¥
    print("\n" + "="*50)
    print("ğŸ“ ìƒ˜í”Œ íƒœê¹… ê²°ê³¼ (ì²˜ìŒ 3ê°œ)")
    print("="*50)

    with open(output_file, 'r', encoding='utf-8') as f:
        for i, line in enumerate(f):
            if i >= 3:
                break
            product = json.loads(line.strip())
            print(f"\n[{i+1}] {product.get('ìƒí’ˆëª…')}")
            print(f"  ì¹´í…Œê³ ë¦¬: {product['tags']['category_tags']}")
            print(f"  ì„±ë¶„: {product['tags']['ingredient_tags']}")
            print(f"  í”¼ë¶€ê³ ë¯¼: {product['tags']['concern_tags']}")
            print(f"  íŠ¹ì§•: {product['tags']['feature_tags']}")
            print(f"  íƒ€ê²Ÿì—°ë ¹ëŒ€: {product['tags']['target_demographics']['age_groups']}")
