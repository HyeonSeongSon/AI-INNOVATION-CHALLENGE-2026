# ë°ì´í„° ì„í¬íŠ¸ ê°€ì´ë“œ

## ğŸ“Š í˜„ì¬ ì¤€ë¹„ëœ ë°ì´í„°

### í¬ë¡¤ë§ ë°ì´í„°: `2512252207.jsonl`
- **ìœ„ì¹˜:** `AI-INNOVATION-CHALLENGE-2026/data/crawling_result/2512252207.jsonl`
- **ìƒí’ˆ ìˆ˜:** 868ê°œ
- **ë¸Œëœë“œ ìˆ˜:** 55ê°œ
- **ë°ì´í„° êµ¬ì¡°:**
  ```json
  {
    "url": "https://www.amoremall.com/kr/ko/product/detail?onlineProdSn=62423",
    "ë¸Œëœë“œ": "ê¸€ë¨íŒœ",
    "ìƒí’ˆëª…": "ë¯¸ìš©ì‹¤ í—¤ì–´ì—ì„¼ìŠ¤ ì—´ì†ìƒë°©ì§€ í—¤ì–´ ì˜¤ì¼ 123ml íƒ1",
    "ë³„ì ": 4.9,
    "ë¦¬ë·°_ê°¯ìˆ˜": 36,
    "ì›ê°€": 39000,
    "í• ì¸ìœ¨": 0,
    "íŒë§¤ê°€": 39000,
    "ìƒí’ˆì´ë¯¸ì§€": ["https://..."],
    "ìƒí’ˆìƒì„¸_ì´ë¯¸ì§€": ["https://..."],
    "êµ¬ë§¤ì_í†µê³„": {},
    "document": "GPT ìƒì„± ë¬¸ì„œ...",
    "tag": "íƒœê·¸ ì •ë³´",
    "í˜ë¥´ì†Œë‚˜íƒœê·¸": {
      "í”¼ë¶€íƒ€ì…": ["ê±´ì„±", "ì§€ì„±"],
      "ê³ ë¯¼í‚¤ì›Œë“œ": ["ë³´ìŠµ", "ì§„ì •"],
      "ì„ í˜¸í¬ì¸íŠ¸ìƒ‰ìƒ": ["ë ˆë“œ", "í•‘í¬"],
      "ì„ í˜¸ì„±ë¶„": ["íˆì•Œë£¨ë¡ ì‚°"],
      "ê¸°í”¼ì„±ë¶„": ["íŒŒë¼ë²¤"],
      "ì„ í˜¸í–¥": ["ë¬´í–¥"],
      "ê°€ì¹˜ê´€": ["ë¹„ê±´"],
      "ì „ìš©ì œí’ˆ": ["ì„ì‚°ë¶€"]
    }
  }
  ```

### ë³€í™˜ëœ SQL íŒŒì¼
1. **04-insert-brands.sql** - 55ê°œ ë¸Œëœë“œ
2. **05-insert-products.sql** - 868ê°œ ìƒí’ˆ (ëª¨ë“  í•„ë“œ í¬í•¨)

---

## ğŸš€ ë‹¨ê³„ë³„ ì‹¤í–‰ ë°©ë²•

### STEP 1: Docker Desktop ì‹œì‘

Docker Desktop ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ê³  ì •ìƒ ì‘ë™ í™•ì¸

### STEP 2: ë°ì´í„°ë² ì´ìŠ¤ ì™„ì „ ì¬êµ¬ì¶•

```bash
cd AI-INNOVATION-CHALLENGE-2026-hs_branch/database

# ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ë° ë³¼ë¥¨ ì‚­ì œ
docker-compose down -v

# ìƒˆ ì»¨í…Œì´ë„ˆ ì‹œì‘ (ì—…ë°ì´íŠ¸ëœ í…Œì´ë¸” êµ¬ì¡°)
docker-compose up -d
```

**ëŒ€ê¸° ì‹œê°„:** ì•½ 10ì´ˆ (PostgreSQL ì´ˆê¸°í™”)

### STEP 3: ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸

```bash
python test_connection.py
```

**ì˜ˆìƒ ì¶œë ¥:**
```
============================================================
PostgreSQL Database Test Suite
============================================================

1. Database Connection Test
[OK] Database connection successful: localhost:5432/ai_innovation_db

2. Table Check
[OK] brands: 5 records
[OK] products: 0 records
[OK] personas: 0 records
[OK] product_personas: 0 records
```

### STEP 4: ë¸Œëœë“œ ë°ì´í„° ì„í¬íŠ¸

```bash
docker exec -i ai-innovation-postgres psql -U postgres ai_innovation_db < init/04-insert-brands.sql
```

**ì˜ˆìƒ ì¶œë ¥:**
```
INSERT 0 1
INSERT 0 1
INSERT 0 1
...
(55ê°œ ë¸Œëœë“œ ì‚½ì…)
```

### STEP 5: ìƒí’ˆ ë°ì´í„° ì„í¬íŠ¸

```bash
docker exec -i ai-innovation-postgres psql -U postgres ai_innovation_db < init/05-insert-products.sql
```

**ì˜ˆìƒ ì¶œë ¥:**
```
INSERT 0 12
INSERT 0 15
INSERT 0 20
...
(868ê°œ ìƒí’ˆ ì‚½ì…)
```

**ì†Œìš” ì‹œê°„:** ì•½ 10~30ì´ˆ

### STEP 6: ì„í¬íŠ¸ ê²°ê³¼ í™•ì¸

```bash
python test_connection.py
```

**ì˜ˆìƒ ì¶œë ¥:**
```
2. Table Check
[OK] brands: 60 records      (5 + 55 = 60ê°œ)
[OK] products: 868 records
[OK] personas: 0 records
[OK] product_personas: 0 records
```

---

## ğŸ” ë°ì´í„° í™•ì¸ (pgAdmin)

### 1. pgAdmin ì ‘ì†

ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:5050` ì ‘ì†
- Email: `admin@admin.com`
- Password: `admin123`

### 2. ì„œë²„ ë“±ë¡ (ì²˜ìŒ í•œ ë²ˆë§Œ)

**General íƒ­:**
- Name: `AI Innovation DB`

**Connection íƒ­:**
- Host: `postgres`
- Port: `5432`
- Database: `postgres`
- Username: `postgres`
- Password: `postgres123`

### 3. ë°ì´í„° í™•ì¸ ì¿¼ë¦¬

```sql
-- 1. ì „ì²´ í†µê³„
SELECT
    'brands' as í…Œì´ë¸”, COUNT(*) as ê°œìˆ˜ FROM brands
UNION ALL
SELECT 'products', COUNT(*) FROM products
UNION ALL
SELECT 'personas', COUNT(*) FROM personas
UNION ALL
SELECT 'product_personas', COUNT(*) FROM product_personas;

-- 2. ë¸Œëœë“œë³„ ìƒí’ˆ ìˆ˜
SELECT
    b.name AS ë¸Œëœë“œëª…,
    COUNT(p.id) AS ìƒí’ˆìˆ˜
FROM brands b
LEFT JOIN products p ON b.id = p.brand_id
GROUP BY b.name
ORDER BY ìƒí’ˆìˆ˜ DESC
LIMIT 20;

-- 3. ê°€ê²©ëŒ€ë³„ ìƒí’ˆ ë¶„í¬
SELECT
    CASE
        WHEN sale_price < 10000 THEN '1ë§Œì› ë¯¸ë§Œ'
        WHEN sale_price < 30000 THEN '1~3ë§Œì›'
        WHEN sale_price < 50000 THEN '3~5ë§Œì›'
        WHEN sale_price < 100000 THEN '5~10ë§Œì›'
        ELSE '10ë§Œì› ì´ìƒ'
    END AS ê°€ê²©ëŒ€,
    COUNT(*) AS ìƒí’ˆìˆ˜,
    ROUND(AVG(sale_price), 0) AS í‰ê· ê°€ê²©
FROM products
WHERE sale_price IS NOT NULL
GROUP BY ê°€ê²©ëŒ€
ORDER BY MIN(sale_price);

-- 4. í‰ì  ë†’ì€ ìƒí’ˆ (ë¦¬ë·° 10ê°œ ì´ìƒ)
SELECT
    b.name AS ë¸Œëœë“œ,
    p.product_name AS ìƒí’ˆëª…,
    p.rating AS ë³„ì ,
    p.review_count AS ë¦¬ë·°ìˆ˜,
    p.sale_price AS íŒë§¤ê°€
FROM products p
JOIN brands b ON p.brand_id = b.id
WHERE p.review_count >= 10
ORDER BY p.rating DESC, p.review_count DESC
LIMIT 20;

-- 5. í˜ë¥´ì†Œë‚˜ íƒœê·¸ í†µê³„
SELECT
    unnest(skin_types) AS í”¼ë¶€íƒ€ì…,
    COUNT(*) AS ìƒí’ˆìˆ˜
FROM products
WHERE array_length(skin_types, 1) > 0
GROUP BY í”¼ë¶€íƒ€ì…
ORDER BY ìƒí’ˆìˆ˜ DESC;

SELECT
    unnest(concern_keywords) AS ê³ ë¯¼í‚¤ì›Œë“œ,
    COUNT(*) AS ìƒí’ˆìˆ˜
FROM products
WHERE array_length(concern_keywords, 1) > 0
GROUP BY ê³ ë¯¼í‚¤ì›Œë“œ
ORDER BY ìƒí’ˆìˆ˜ DESC
LIMIT 20;

-- 6. í• ì¸ìœ¨ì´ ë†’ì€ ìƒí’ˆ
SELECT
    b.name AS ë¸Œëœë“œ,
    p.product_name AS ìƒí’ˆëª…,
    p.original_price AS ì›ê°€,
    p.discount_rate AS í• ì¸ìœ¨,
    p.sale_price AS íŒë§¤ê°€,
    (p.original_price - p.sale_price) AS í• ì¸ê¸ˆì•¡
FROM products p
JOIN brands b ON p.brand_id = b.id
WHERE p.discount_rate > 0
ORDER BY p.discount_rate DESC
LIMIT 20;
```

---

## ğŸ“Š ì„í¬íŠ¸ëœ ë°ì´í„° êµ¬ì¡°

### Products í…Œì´ë¸” - ëª¨ë“  í•„ë“œ í™•ì¸

```sql
SELECT
    id,
    product_name,
    original_price,
    sale_price,
    rating,
    review_count,
    skin_types,
    concern_keywords,
    preferred_ingredients,
    avoided_ingredients,
    image_urls,
    LENGTH(generated_document) as document_length
FROM products
LIMIT 5;
```

**í¬í•¨ëœ ë°ì´í„°:**
- âœ… ê°€ê²© ì •ë³´ (ì›ê°€, í• ì¸ìœ¨, íŒë§¤ê°€)
- âœ… í‰ì /ë¦¬ë·°
- âœ… í”¼ë¶€íƒ€ì… (ë°°ì—´)
- âœ… ê³ ë¯¼ í‚¤ì›Œë“œ (ë°°ì—´)
- âœ… ë©”ì´í¬ì—… ìƒ‰ìƒ (ë°°ì—´)
- âœ… ì„ í˜¸/ê¸°í”¼ ì„±ë¶„ (ë°°ì—´)
- âœ… ì„ í˜¸ í–¥ (ë°°ì—´)
- âœ… ê°€ì¹˜ê´€ (ë°°ì—´)
- âœ… ì „ìš©ì œí’ˆ (ë°°ì—´)
- âœ… ìƒí’ˆ ì´ë¯¸ì§€ URL (ë°°ì—´)
- âœ… GPT ìƒì„± ë¬¸ì„œ
- âœ… êµ¬ë§¤ì í†µê³„ (JSONB)

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„: API ì„œë²„ í…ŒìŠ¤íŠ¸

ë°ì´í„° ì„í¬íŠ¸ê°€ ì™„ë£Œë˜ë©´ API ì„œë²„ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.

```bash
cd AI-INNOVATION-CHALLENGE-2026-hs_branch/database
python api_server.py
```

**API ì ‘ì†:**
- Swagger UI: `http://localhost:8000/docs`
- Health Check: `http://localhost:8000/health`

**í…ŒìŠ¤íŠ¸ ì¿¼ë¦¬:**
```bash
# ë¸Œëœë“œ ëª©ë¡
curl http://localhost:8000/api/brands

# ìƒí’ˆ ê²€ìƒ‰ (í”¼ë¶€íƒ€ì…)
curl "http://localhost:8000/api/products?category=ìŠ¤í‚¨ì¼€ì–´&limit=10"

# íŠ¹ì • ìƒí’ˆ ìƒì„¸
curl http://localhost:8000/api/products/1
```

---

## âš ï¸ ë¬¸ì œ í•´ê²°

### 1. Docker ì—°ê²° ì‹¤íŒ¨

**ì¦ìƒ:** `error during connect: ... dockerDesktopLinuxEngine`

**í•´ê²°:**
```bash
# Docker Desktop ì‹¤í–‰ í™•ì¸
# Windows: Docker Desktop ì•± ì‹¤í–‰
# ì •ìƒ ì‘ë™ê¹Œì§€ ì•½ 30ì´ˆ ëŒ€ê¸°
```

### 2. SQL ì„í¬íŠ¸ ì‹¤íŒ¨

**ì¦ìƒ:** `No such file or directory`

**í•´ê²°:**
```bash
# íŒŒì¼ ì¡´ì¬ í™•ì¸
ls -la init/

# SQL íŒŒì¼ ì¬ìƒì„±
python jsonl_to_sql_new.py

# ì ˆëŒ€ ê²½ë¡œ ì‚¬ìš©
docker exec -i ai-innovation-postgres psql -U postgres ai_innovation_db < "$(pwd)/init/04-insert-brands.sql"
```

### 3. ì¸ì½”ë”© ì˜¤ë¥˜

**ì¦ìƒ:** `UnicodeDecodeError`

**í•´ê²°:**
```bash
# PowerShell ì‚¬ìš© (Windows)
Get-Content init\04-insert-brands.sql | docker exec -i ai-innovation-postgres psql -U postgres ai_innovation_db
```

### 4. ì¤‘ë³µ ë°ì´í„°

**ì¦ìƒ:** `duplicate key value violates unique constraint`

**í•´ê²°:**
```bash
# ë°ì´í„°ë² ì´ìŠ¤ ì™„ì „ ì´ˆê¸°í™”
docker-compose down -v
docker-compose up -d
sleep 10
python test_connection.py
```

---

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Docker Desktop ì‹¤í–‰
- [ ] `docker-compose down -v` ì‹¤í–‰
- [ ] `docker-compose up -d` ì‹¤í–‰
- [ ] `python test_connection.py` - ì—°ê²° í™•ì¸
- [ ] `docker exec ... < 04-insert-brands.sql` - ë¸Œëœë“œ ì„í¬íŠ¸
- [ ] `docker exec ... < 05-insert-products.sql` - ìƒí’ˆ ì„í¬íŠ¸
- [ ] `python test_connection.py` - ë°ì´í„° í™•ì¸ (868ê°œ ìƒí’ˆ)
- [ ] pgAdmin ì ‘ì† ë° ë°ì´í„° í™•ì¸
- [ ] `python api_server.py` - API ì„œë²„ ì‹œì‘
- [ ] Swagger UI ì ‘ì† (`http://localhost:8000/docs`)

---

## ğŸ‰ ì™„ë£Œ!

ëª¨ë“  ë‹¨ê³„ë¥¼ ì™„ë£Œí•˜ë©´:
- âœ… 55ê°œ ë¸Œëœë“œ ë°ì´í„°
- âœ… 868ê°œ ìƒí’ˆ ë°ì´í„° (ëª¨ë“  í•„ë“œ í¬í•¨)
- âœ… í˜ë¥´ì†Œë‚˜ ë§¤ì¹­ìš© ì†ì„± (í”¼ë¶€íƒ€ì…, ê³ ë¯¼, ì„±ë¶„ ë“±)
- âœ… API ì„œë²„ ì¤€ë¹„ ì™„ë£Œ

ì´ì œ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ í˜ë¥´ì†Œë‚˜ë¥¼ ì¶”ê°€í•˜ê³  ìƒí’ˆ ì¶”ì²œì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤!
